<div id='productGallery' style='width: 100%;'>
    <style>

        @media only screen and (min-width: 100px) {

        }

        #gkProductGallery {
            width: 100%;
            margin: 0 auto;
            position: relative;
        }

        .gallery-header {
            text-align: center;
            font-size: 46px;
            line-height: 46px;
            font-family: 'adobe-garamond-pro';
            color: #484848;

            margin-bottom: 10px
        }

        .gallery-header-border-bottom {
            width: 90px;
            border-bottom: 1px solid rgba(0,0,0,.15);
            margin-left: auto;
            margin-right: auto;
        }

        .links {
            text-align: center;
            line-height: 60px;
        }

        .link {
            display: inline-block;
            margin-right: 10px;
            text-transform: uppercase;
            font-size: 14px;
            font-family: "proxima-nova";
            color: #484848;
        }

        .link-bullet {
            display: inline-block;
            height: 60px;
            width: 3px;
            margin-right: 10px;
            vertical-align: bottom;
            background-image: url('https://static1.squarespace.com/static/52d881e0e4b093afad1a2ae2/t/5563a289e4b08b2ebc704d9b/1432593036851/?format=100w&storage=local');
            background-repeat: no-repeat;
            background-position: center;
        }

        .link.active {
            color: #3156c4;
        }

        .images-container {
            width: 100%;
            height: 400px;
            position: relative;
            overflow: hidden;
        }

        .image {
            position: absolute;
            opacity: 0;
            height: 400px;
            width: 100%;
            transition: opacity 0.5s ease;
        }

        .image img {
            height: 400px;
            width: 100%;
        }

        .image.active {
            opacity: 1;
        }

        .transport-controls-overlay {
            width: 100%;
            height: 400px;
            position: absolute;
            top: 118px;
            left: 0;
        }

        .previous-arrow-container{
            height: 100%;
            line-height: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }

        .previous-arrow {
            font-family: 'squarespace-ui-font';
            font-style: normal;
            speak: none;
            font-weight: normal;
            -webkit-font-smoothing: antialiased;
            content: "\e02c";
            text-align: center;
            display: inline-block;
            vertical-align: middle;
        }

        .subtitle-description-container {
            height: 115px;
            line-height: 115px;

            width: 100%;

            display: flex;
            justify-content: flex-start;
            flex-direction: row;
            align-items: center;
        }

        .subtitle {
            width: 30%;
            font-family: 'adobe-garamond-pro';

            font-size: 34px;
            line-height: 34px;
            color: #484848;
        }

        .description {
            width: 70%;
            text-align: left;
            font-size: 19px;
            line-height: 19px;
            color: #484848;
        }

    </style>

    <div id='gkProductGallery'>
        <div class='gallery-header'></div>
        <div class='gallery-header-border-bottom'></div>
        <div class='links'>
            <div id='bulletTemplate' class='link-bullet'></div>
            <div id='linkTemplate' class='' img-selector='' subtitle='' description=''></div>
        </div>
        <div class='images-container'>
            <div id='imageTemplate' class=''>
                <img />
            </div>
        </div>
        <div class='transport-controls-overlay'>
            <div class='previous-arrow-container'>
                <div class='previous-arrow'></div>
            </div>
        </div>
        <div class='subtitle-description-container'>
            <div class='subtitle'></div>
            <div class='description'></div>
        </div>
    </div>

    <script type='text/javascript'>
        (function(globals) {
            //////////////////////////////////////////////////////////////////
            var thisGalleriesUrl = '/product-galleries/mb-fusion-800-design' || globals.thisGalleriesUrl;
            //////////////////////////////////////////////////////////////////
            YUI().use('io', 'promise', function (Y) {
                var productGallery = {
                    start : start,
                    getProductJson : getProductJson,
                    createDomStructure : createDomStructure,
                    addEventListeners : addEventListeners,
                    header : null,
                    products : null,
                    $container : null
                };

                function start() {
                    // toggleLoadingSpinner();

                    productGallery.getProductJson()
                        .then(function(serverResponse) {
                            productGallery.products = deserializeServerResponseProducts(serverResponse);
                            productGallery.header = deserializeServerResponseHeader(serverResponse);

                            productGallery.$container = document.querySelector('#productGallery');

                            productGallery.createDomStructure();
                            productGallery.addEventListeners();

                            // toggleLoadingSpinner();
                        }, function() {
                            document.querySelector('#productGallery').parentElement.removeChild(document.querySelector('#productGallery'));
                        });
                }

                function getProductJson() {
                    return new Y.Promise(function (resolve, reject) {
                        Y.io(thisGalleriesUrl + '?format=json-pretty', {
                            on: {
                                start : function() {},
                                success: function(transactionId, repsonseObj) {
                                    resolve(JSON.parse(repsonseObj.response));
                                },
                                complete : function() {},
                                failure : reject,
                                end : function() {}
                            }
                        });
                    });
                }

                function deserializeServerResponseProducts(serverResponse) {
                    return serverResponse.items.map(function(item) {
                        return {
                            linkText : item.title,
                            imageUrl : item.assetUrl,
                            subtitleText : item.title,
                            description : item.body
                        };
                    });
                }

                function deserializeServerResponseHeader(serverResponse) {
                    return serverResponse.collection.description;
                }

                function createDomStructure() {
                    var $linksArea = productGallery.$container.querySelector('.links'),
                        $imagesArea = productGallery.$container.querySelector('.images-container'),
                        bulletTemplate = productGallery.$container.querySelector('#bulletTemplate'),
                        linkTemplate = productGallery.$container.querySelector('#linkTemplate'),
                        imageTemplate = productGallery.$container.querySelector('#imageTemplate');

                    for(var i = 0, max = productGallery.products.length; i < max; i++) {
                        var linkElement = linkTemplate.cloneNode(true),
                            imageElement = imageTemplate.cloneNode(true),
                            bulletElement = bulletTemplate.cloneNode(true);

                        linkElement.classList.add('link');
                        linkElement.setAttribute('img-selector', '#productGalleryImage'+ i);
                        linkElement.setAttribute('subtitle', productGallery.products[i].subtitleText);
                        linkElement.setAttribute('description', productGallery.products[i].description);
                        linkElement.id = '';

                        linkElement.innerText = productGallery.products[i].linkText;

                        imageElement.id = 'productGalleryImage'+ i;
                        imageElement.classList.add('image');
                        imageElement.querySelector('img').src = productGallery.products[i].imageUrl;

                        if(i === 0) {
                            imageElement.classList.add('active');
                            linkElement.classList.add('active');

                            productGallery.$container.querySelector('.subtitle').innerText = productGallery.products[i].subtitleText;
                            productGallery.$container.querySelector('.description').innerHTML = productGallery.products[i].description;
                        } else {
                            bulletElement.id = '';
                            $linksArea.appendChild(bulletElement);
                        }

                        $linksArea.appendChild(linkElement);
                        $imagesArea.appendChild(imageElement);
                    }

                    productGallery.$container.querySelector('.gallery-header').innerHTML = productGallery.header;

                    linkTemplate.parentElement.removeChild(linkTemplate);
                    imageTemplate.parentElement.removeChild(imageTemplate);
                    bulletTemplate.parentElement.removeChild(bulletTemplate);

                }

                function addEventListeners() {
                    var subtitleNode = productGallery.$container.querySelector('.subtitle'),
                        descriptionNode = productGallery.$container.querySelector('.description'),
                        linkNodes = productGallery.$container.querySelectorAll('.link'),
                        imageNodes = productGallery.$container.querySelectorAll('.image');

                    [].forEach.call(linkNodes, function(linkNode) {
                        linkNode.addEventListener('click', function() {
                            var imageSelector = linkNode.getAttribute('img-selector'),
                                subtitle = linkNode.getAttribute('subtitle'),
                                description = linkNode.getAttribute('description');

                            [].forEach.call(linkNodes, function(linkNode) {
                                linkNode.classList.remove('active');
                            });

                            [].forEach.call(imageNodes, function(imageNode) {
                                imageNode.classList.remove('active');
                            });

                            linkNode.classList.add('active');

                            productGallery.$container.querySelector(imageSelector)
                                .classList.add('active');

                            subtitleNode.innerText = subtitle;
                            descriptionNode.innerHTML = description;
                        });
                    });
                }

                document.addEventListener('DOMContentLoaded', function() {
                    productGallery.start();
                });
            });

        })(window);
    </script>
</div>
