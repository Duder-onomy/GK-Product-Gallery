<div id='productGallery' style='width: 100%;'>
    <style>

        @media only screen and (min-width: 100px) {

        }

        #gkProductGallery {
            width: 800px;
            margin: 0 auto;
        }

        .links {
            text-align: center;
            line-height: 60px;
        }

        .link {
            color: blue;
            display: inline-block;
            margin-right: 10px;
        }
        .link.active {
            color: lime;
        }

        .images-container {
            width: 100%;
            height: 400px;
            position: relative;
            overflow: hidden;
        }

        .image {
            position: absolute;
            opacity: 0;
            height: 400px;
            width: 100%;
            transition: opacity 0.5s ease;
        }

        .image img {
            height: 400px;
            width: 800px;
        }

        .image.active {
            opacity: 1;
        }
    </style>

    <div id='gkProductGallery'>
        <div class='links'>
            <div id='linkTemplate' class='' img-selector='' subtitle='' description=''></div>
        </div>
        <div class='images-container'>
            <div id='imageTemplate' class=''>
                <img />
            </div>
        </div>
        <div class='subtitle'></div>
        <div class='description'></div>
    </div>

    <script type='text/javascript'>
        //////////////////////////////////////////////////////////////////
        var thisGalleriesUrl = '/productgallery/mb-fusion-800';
        //////////////////////////////////////////////////////////////////
        YUI().use('io', 'promise', function (Y) {
            var productGallery = {
                start : start,
                getProductJson : getProductJson,
                createDomStructure : createDomStructure,
                addEventListeners : addEventListeners,
                products : null,
                $container : null
            };

            function start() {
                // toggleLoadingSpinner();

                productGallery.getProductJson()
                    .then(function(serverResponse) {
                        productGallery.products = deserializeServerResponse(serverResponse);

                        productGallery.$container = document.querySelector('#productGallery');

                        productGallery.createDomStructure();
                        productGallery.addEventListeners();

                        // toggleLoadingSpinner();
                    }, function() {
                        document.querySelector('#productGallery').parentElement.removeChild(document.querySelector('#productGallery'));
                    });
            }

            function getProductJson() {
                return new Y.Promise(function (resolve, reject) {
                    Y.io(thisGalleriesUrl + '?format=json-pretty', {
                        on: {
                            start : function() {},
                            success: function(transactionId, repsonseObj) {
                                resolve(JSON.parse(repsonseObj.response));
                            },
                            complete : function() {},
                            failure : function() {
                                reject();
                            },
                            end : function() {}
                        }
                    });
                });
            }

            function deserializeServerResponse(serverResponse) {
                var products = [];

                serverResponse.items.forEach(function(item) {
                    products.push({
                        linkText : item.title,
                        imageUrl : item.assetUrl,
                        subtitleText : item.title,
                        description : item.body
                    });
                });

                return products;
            }

            function createDomStructure() {
                var $linksArea = productGallery.$container.querySelector('.links'),
                    $imagesArea = productGallery.$container.querySelector('.images-container'),
                    linkTemplate = productGallery.$container.querySelector('#linkTemplate'),
                    imageTemplate = productGallery.$container.querySelector('#imageTemplate');

                for(var i = 0, max = productGallery.products.length; i < max; i++) {
                    var linkElement = linkTemplate.cloneNode(true),
                        imageElement = imageTemplate.cloneNode(true);

                    linkElement.classList.add('link');
                    linkElement.setAttribute('img-selector', '#productGalleryImage'+ i);
                    linkElement.setAttribute('subtitle', productGallery.products[i].subtitleText);
                    linkElement.setAttribute('description', productGallery.products[i].description);
                    linkElement.id = '';

                    linkElement.innerText = productGallery.products[i].linkText;

                    imageElement.id = 'productGalleryImage'+ i;
                    imageElement.classList.add('image');
                    imageElement.querySelector('img').src = productGallery.products[i].imageUrl;

                    if(i === 0) {
                        imageElement.classList.add('active');
                        linkElement.classList.add('active');
                    }

                    $linksArea.appendChild(linkElement);
                    $imagesArea.appendChild(imageElement);
                }

                linkTemplate.parentElement.removeChild(linkTemplate);
                imageTemplate.parentElement.removeChild(imageTemplate);


            }

            function addEventListeners() {
                var subtitleNode = productGallery.$container.querySelector('.subtitle'),
                    descriptionNode = productGallery.$container.querySelector('.description'),
                    linkNodes = productGallery.$container.querySelectorAll('.link'),
                    imageNodes = productGallery.$container.querySelectorAll('.image');

                [].forEach.call(linkNodes, function(linkNode) {
                    linkNode.addEventListener('click', function() {
                        var imageSelector = linkNode.getAttribute('img-selector'),
                            subtitle = linkNode.getAttribute('subtitle'),
                            description = linkNode.getAttribute('description');

                        [].forEach.call(linkNodes, function(linkNode) {
                            linkNode.classList.remove('active');
                        });

                        [].forEach.call(imageNodes, function(imageNode) {
                            imageNode.classList.remove('active');
                        });

                        linkNode.classList.add('active');

                        productGallery.$container.querySelector(imageSelector)
                            .classList.add('active');

                        subtitleNode.innerText = subtitle;
                        descriptionNode.innerHTML = description;
                    });
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                productGallery.start();
            });
        });

    </script>
</div>
